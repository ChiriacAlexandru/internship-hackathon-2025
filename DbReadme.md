users (Admin, Dev, PO)
â””â”€â”€< projects_members (legÄƒturÄƒ user-proiect)
projects
â”œâ”€â”€< rules (set de reguli impuse)
â”œâ”€â”€< reviews (rulÄƒri AI)
â”‚ â”œâ”€â”€< findings (probleme detectate)
â”‚ â”‚ â””â”€â”€< comments (discuÈ›ii pe findings)
â”‚ â””â”€â”€< token_usage (consum AI)
â””â”€â”€< milestones (pentru PO, timeline)

# ðŸ§© Database Structure â€” AI Code Review Assistant (PostgreSQL)

## ðŸ§  Overview

This document describes the **PostgreSQL database schema** for the **AI Code Review Assistant** project.  
The database is designed to support:

- Multi-role user management (Admin, Developer, Product Owner)
- Projects with assigned members
- AI-based code reviews and rule enforcement
- Findings, comments, and automatic fixes
- Product Owner summaries and project milestones
- Local cost tracking for AI usage

---

## ðŸ—ƒï¸ Table Summary

| Table              | Purpose                                                |
| ------------------ | ------------------------------------------------------ |
| `users`            | Stores platform user accounts and global roles         |
| `projects`         | Defines projects (linked to Git repositories or apps)  |
| `projects_members` | Connects users to projects with project-specific roles |
| `rules`            | Defines coding rules (global or per-project)           |
| `reviews`          | Represents a single AI review session                  |
| `findings`         | Stores detected issues or suggestions from the AI      |
| `comments`         | Threaded discussion for each finding                   |
| `token_usage`      | Tracks local AI inference usage and performance        |
| `milestones`       | Stores project timeline progress for Product Owners    |
| `reports`          | Stores non-technical summaries generated by the AI     |

---

## ðŸ‘¥ 1. `users`

Stores user information and their global role on the platform.

| Column          | Type                              | Description                |
| --------------- | --------------------------------- | -------------------------- |
| `id`            | SERIAL PK                         | Unique user ID             |
| `email`         | TEXT UNIQUE                       | Login email address        |
| `password_hash` | TEXT                              | Hashed password (bcrypt)   |
| `display_name`  | TEXT                              | Display name (for UI)      |
| `role`          | TEXT (`'ADMIN'`, `'DEV'`, `'PO'`) | Global role                |
| `created_at`    | TIMESTAMP DEFAULT now()           | Account creation timestamp |

ðŸ”¹ **Example**  
Admin creates all accounts (no self-registration).  
Each user can have a global role and also a specific role inside a project (see `projects_members`).

---

## ðŸ§± 2. `projects`

Defines software projects managed by Admins and worked on by Developers and Product Owners.

| Column       | Type                    | Description               |
| ------------ | ----------------------- | ------------------------- |
| `id`         | SERIAL PK               | Project ID                |
| `name`       | TEXT                    | Project name              |
| `repo_path`  | TEXT                    | Local Git repository path |
| `created_by` | INT FK â†’ `users(id)`    | Project creator (Admin)   |
| `created_at` | TIMESTAMP DEFAULT now() | Date created              |

ðŸ”¹ **Notes**

- Each project may have multiple members (via `projects_members`).
- Optional: repo path can be used for automated `git diff` operations.

---

## ðŸ‘¥ 3. `projects_members`

Associates users with projects and defines their specific project-level roles.

| Column            | Type                    | Description              |
| ----------------- | ----------------------- | ------------------------ |
| `id`              | SERIAL PK               | Link ID                  |
| `project_id`      | INT FK â†’ `projects(id)` | Related project          |
| `user_id`         | INT FK â†’ `users(id)`    | Related user             |
| `role_in_project` | TEXT (`'DEV'`, `'PO'`)  | Role within that project |

ðŸ”¹ **Notes**

- A user can be DEV in one project and PO in another.
- Admins are not stored here â€” they have global visibility.

---

## âš™ï¸ 4. `rules`

Defines coding standards and guidelines used for automated checks.

| Column       | Type                                                                 | Description                                   |
| ------------ | -------------------------------------------------------------------- | --------------------------------------------- |
| `id`         | SERIAL PK                                                            | Rule ID                                       |
| `project_id` | INT FK â†’ `projects(id)`                                              | Null if global rule                           |
| `key`        | TEXT                                                                 | Rule key (ex: `no-eval`, `require-docstring`) |
| `level`      | TEXT (`'low'`, `'medium'`, `'high'`, `'critical'`)                   | Severity level                                |
| `message`    | TEXT                                                                 | Explanation for violation                     |
| `pattern`    | TEXT                                                                 | Regex pattern for quick static check          |
| `type`       | TEXT (`'security'`, `'style'`, `'performance'`, `'docs'`, `'tests'`) | Rule category                                 |
| `global`     | BOOLEAN DEFAULT false                                                | Whether the rule applies to all projects      |

ðŸ”¹ **Notes**

- Admins define global rules.
- Projects can have additional custom rules.

---

## ðŸ” 5. `reviews`

Represents a single execution of AI code analysis.

| Column       | Type                                            | Description                      |
| ------------ | ----------------------------------------------- | -------------------------------- |
| `id`         | SERIAL PK                                       | Review ID                        |
| `project_id` | INT FK â†’ `projects(id)`                         | Project reviewed                 |
| `user_id`    | INT FK â†’ `users(id)`                            | Developer who triggered review   |
| `mode`       | TEXT (`'upload'`, `'git-staged'`, `'git-base'`) | Type of review                   |
| `raw_input`  | TEXT                                            | Full code or diff analyzed       |
| `summary`    | TEXT                                            | Short textual summary (optional) |
| `created_at` | TIMESTAMP DEFAULT now()                         | Date of review                   |

ðŸ”¹ **Notes**

- Each review generates multiple findings.
- Reviews can be triggered manually (button) or via Git hook.

---

## âš ï¸ 6. `findings`

Each problem, warning, or suggestion identified by the AI or rule engine.

| Column           | Type                                               | Description                            |
| ---------------- | -------------------------------------------------- | -------------------------------------- |
| `id`             | SERIAL PK                                          | Finding ID                             |
| `review_id`      | INT FK â†’ `reviews(id)`                             | Related review                         |
| `file`           | TEXT                                               | File path                              |
| `line_start`     | INT                                                | Line start                             |
| `line_end`       | INT                                                | Line end                               |
| `category`       | TEXT                                               | Category (security, performance, etc.) |
| `severity`       | TEXT (`'low'`, `'medium'`, `'high'`, `'critical'`) | Severity level                         |
| `title`          | TEXT                                               | Short description                      |
| `explanation`    | TEXT                                               | Explanation of issue                   |
| `recommendation` | TEXT                                               | Recommended fix                        |
| `effort_min`     | INT                                                | Estimated fix time (minutes)           |
| `autofix_patch`  | TEXT                                               | Unified diff patch (optional)          |

ðŸ”¹ **Notes**

- Auto-fix patches can be applied using the `patchSvc`.
- Each finding can have threaded comments.

---

## ðŸ’¬ 7. `comments`

Discussion threads related to findings.

| Column       | Type                    | Description     |
| ------------ | ----------------------- | --------------- |
| `id`         | SERIAL PK               | Comment ID      |
| `finding_id` | INT FK â†’ `findings(id)` | Related finding |
| `author_id`  | INT FK â†’ `users(id)`    | Comment author  |
| `body`       | TEXT                    | Comment content |
| `created_at` | TIMESTAMP DEFAULT now() | Date/time       |

ðŸ”¹ **Notes**

- Used for internal team discussions during review.
- Each finding can have multiple comments.

---

## ðŸ’° 8. `token_usage`

Tracks AI performance metrics and usage cost.

| Column       | Type                   | Description                                |
| ------------ | ---------------------- | ------------------------------------------ |
| `id`         | SERIAL PK              | Usage record ID                            |
| `review_id`  | INT FK â†’ `reviews(id)` | Related review                             |
| `model`      | TEXT                   | AI model used (e.g. `deepseek-coder:6.7b`) |
| `chars_in`   | INT                    | Characters sent to the AI                  |
| `chars_out`  | INT                    | Characters received from the AI            |
| `latency_ms` | INT                    | Time taken (milliseconds)                  |

ðŸ”¹ **Notes**

- Useful for analytics and optimization.
- Enables local cost tracking (resource awareness).

---

## ðŸ•’ 9. `milestones`

Used by Product Owners to track project progress and deadlines.

| Column         | Type                                                       | Description             |
| -------------- | ---------------------------------------------------------- | ----------------------- |
| `id`           | SERIAL PK                                                  | Milestone ID            |
| `project_id`   | INT FK â†’ `projects(id)`                                    | Related project         |
| `title`        | TEXT                                                       | Milestone title         |
| `planned_date` | DATE                                                       | Planned completion date |
| `status`       | TEXT (`'planned'`, `'in_progress'`, `'blocked'`, `'done'`) | Current status          |
| `notes`        | TEXT                                                       | Comments or updates     |

ðŸ”¹ **Notes**

- Shown in PO dashboard to visualize project progress.
- Linked to AI-generated reports.

---

## ðŸ“Š 10. `reports`

Stores non-technical summaries and AI-generated project evaluations for Product Owners.

| Column                | Type                                          | Description                    |
| --------------------- | --------------------------------------------- | ------------------------------ |
| `id`                  | SERIAL PK                                     | Report ID                      |
| `project_id`          | INT FK â†’ `projects(id)`                       | Related project                |
| `generated_by`        | INT FK â†’ `users(id)`                          | Product Owner who requested it |
| `overall_quality`     | TEXT (`'good'`, `'fair'`, `'poor'`)           | General assessment             |
| `risk_areas`          | TEXT[]                                        | Risk areas detected            |
| `summary`             | TEXT                                          | Human-readable explanation     |
| `timeline_confidence` | TEXT (`'on_track'`, `'at_risk'`, `'delayed'`) | Schedule confidence            |
| `created_at`          | TIMESTAMP DEFAULT now()                       | Generation date                |

ðŸ”¹ **Notes**

- Generated by AI upon PO request.
- Can be exported as PDF or Markdown in the frontend.

---

## ðŸ”— Relationships Summary

users (1)â”€â”€â”€< projects_members >â”€â”€â”€(1) projects
â”‚ â”‚
â”‚ â”œâ”€â”€< rules
â”‚ â”œâ”€â”€< reviews
â”‚ â”‚ â”œâ”€â”€< findings
â”‚ â”‚ â”‚ â””â”€â”€< comments
â”‚ â”‚ â””â”€â”€< token_usage
â”‚ â”œâ”€â”€< milestones
â”‚ â””â”€â”€< reports

---

## ðŸ§¾ Example SQL Relationships

```sql
ALTER TABLE projects
  ADD CONSTRAINT fk_project_admin FOREIGN KEY (created_by)
  REFERENCES users(id) ON DELETE SET NULL;

ALTER TABLE projects_members
  ADD FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  ADD FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;

ALTER TABLE rules
  ADD FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE;

ALTER TABLE reviews
  ADD FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE SET NULL,
  ADD FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL;

ALTER TABLE findings
  ADD FOREIGN KEY (review_id) REFERENCES reviews(id) ON DELETE CASCADE;

ALTER TABLE comments
  ADD FOREIGN KEY (finding_id) REFERENCES findings(id) ON DELETE CASCADE,
  ADD FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE SET NULL;

ALTER TABLE token_usage
  ADD FOREIGN KEY (review_id) REFERENCES reviews(id) ON DELETE CASCADE;

ALTER TABLE milestones
  ADD FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE;

ALTER TABLE reports
  ADD FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  ADD FOREIGN KEY (generated_by) REFERENCES users(id) ON DELETE SET NULL;
```

a
